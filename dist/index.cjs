"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const I=require("@flinbein/varhub-web-client"),c=require("react"),n=require("react/jsx-dev-runtime"),h=require("classnames"),j=require("react-hook-form"),A=require("use-latest-callback");async function E(e){const{serverUrl:t,playerName:r,settings:s={},importRoomModule:i,roomIntegrity:a,engine:u="ivm",roomPublicMessage:l}=e;let o=e.roomId;const m=new I.Varhub(t);if(!o){const{integrity:b,module:N}=await i();o=(await m.createRoom(u,{module:N,integrity:b,config:s,message:l})).id}const f=m.join(o,{params:[r],integrity:a});return{roomId:o,client:f,playerName:r}}const C=e=>{const t=new URLSearchParams(location.search),r=JSON.parse(history?.state?.varhubEnterState||"{}"),s=t.get("serverUrl")??r.serverUrl??e.serverUrl??void 0,i=t.get("roomId")??r.roomId??void 0,a=r.playerName??void 0,u=r.settings??e.settings??{},l=r.autoJoin??!1;return{serverUrl:s,roomId:i,playerName:a,autoJoin:l,settings:u}},k=e=>{const t=new URL(location.href),r={varhubEnterState:JSON.stringify(e||{})};t.search="",history.replaceState(r,"",t)},S=e=>c.useRef(C(e)).current,M=({size:e})=>n.jsxDEV("span",{className:"vh-loader",style:{height:e,width:e}},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Loader/Loader.tsx",lineNumber:10,columnNumber:9},void 0),U=e=>{const{children:t,title:r,actions:s,loading:i,error:a}=e;return n.jsxDEV("div",{className:h("varhub-card"),children:[n.jsxDEV("div",{className:"varhub-card__content varhub-card__header",children:[n.jsxDEV("h2",{className:"varhub-card__header__text",children:r},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Card/Card.tsx",lineNumber:20,columnNumber:17},void 0),i&&n.jsxDEV(M,{size:24},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Card/Card.tsx",lineNumber:21,columnNumber:29},void 0)]},void 0,!0,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Card/Card.tsx",lineNumber:19,columnNumber:13},void 0),n.jsxDEV("div",{className:"varhub-card__content varhub-card__body",children:t},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Card/Card.tsx",lineNumber:23,columnNumber:13},void 0),s&&n.jsxDEV("div",{className:"varhub-card__content varhub-card__actions varhub-card__divider--top",children:s},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Card/Card.tsx",lineNumber:28,columnNumber:17},void 0),a&&n.jsxDEV("div",{className:"varhub-card__error varhub-card__content varhub-card__divider--top",children:a},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Card/Card.tsx",lineNumber:34,columnNumber:17},void 0),n.jsxDEV("div",{className:"varhub-card__powered-by varhub-card__content varhub-card__divider--top",children:["Powered by ",n.jsxDEV("a",{className:"varhub-card__link",href:"https://github.com/flinbein/varhub-web-server",children:"VarHub"},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Card/Card.tsx",lineNumber:40,columnNumber:28},void 0)]},void 0,!0,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Card/Card.tsx",lineNumber:39,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Card/Card.tsx",lineNumber:18,columnNumber:9},void 0)},V=e=>{const{name:t,placeholder:r,label:s=e.name,className:i="vh-mt-3",required:a=!1,pattern:u,patternMessage:l}=e,{register:o}=j.useFormContext(),m=c.useMemo(()=>{if(u)return{value:u,message:l||"Invalid pattern"}},[u,l]);return n.jsxDEV("div",{className:h("varhub-parameter-input",i),children:[n.jsxDEV("input",{placeholder:r,type:"text",required:a,...o(t,{shouldUnregister:!0,required:a,pattern:m})},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/parameter/VarhubInputParameter.tsx",lineNumber:36,columnNumber:13},void 0),n.jsxDEV("label",{children:s},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/parameter/VarhubInputParameter.tsx",lineNumber:37,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/parameter/VarhubInputParameter.tsx",lineNumber:35,columnNumber:9},void 0)},R=({direction:e})=>n.jsxDEV("i",{className:h("vh-arrow",e)},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/icon/ArrowIcon.tsx",lineNumber:13,columnNumber:9},void 0),q=({children:e})=>{const[t,r]=c.useState(!1),s=c.useCallback(()=>{r(i=>!i)},[r]);return n.jsxDEV("div",{className:"vh-settings-section varhub-card__divider--top",children:[n.jsxDEV("h5",{className:"vh-settings-section__title",children:["Settings",n.jsxDEV("a",{className:h("vh-settings-section__title__button",{reversed:t}),onClick:s,type:"button",children:n.jsxDEV(R,{direction:"down"},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/settings/SettingsSection.tsx",lineNumber:24,columnNumber:21},void 0)},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/settings/SettingsSection.tsx",lineNumber:19,columnNumber:17},void 0)]},void 0,!0,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/settings/SettingsSection.tsx",lineNumber:17,columnNumber:13},void 0),n.jsxDEV("div",{className:`vh-settings-section__body ${t?"shown":"hidden"}`,children:e},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/settings/SettingsSection.tsx",lineNumber:27,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/settings/SettingsSection.tsx",lineNumber:16,columnNumber:9},void 0)},D=e=>{const{children:t,htmlType:r,type:s="primary",className:i,onClick:a,disabled:u,...l}=e,o=m=>{u||a?.(m)};return n.jsxDEV("button",{type:r,...l,onClick:o,disabled:u,className:h("varhub-button",i,{[`type-${s}`]:s}),children:t},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Button/VarhubButton.tsx",lineNumber:34,columnNumber:9},void 0)},w=e=>{const{name:t,placeholder:r,label:s=e.name,className:i="vh-mt-3",min:a,max:u,required:l=!1}=e,{register:o}=j.useFormContext(),m=c.useCallback(f=>{const b=parseInt(f);if(!isNaN(b))return b},[]);return n.jsxDEV("div",{className:h("varhub-parameter-input",i),children:[n.jsxDEV("input",{placeholder:r,type:"number",min:a,max:u,...o(t,{min:a,max:u,shouldUnregister:!0,required:l,setValueAs:m})},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/parameter/VarhubNumberParameter.tsx",lineNumber:38,columnNumber:13},void 0),n.jsxDEV("label",{children:s},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/parameter/VarhubNumberParameter.tsx",lineNumber:45,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/parameter/VarhubNumberParameter.tsx",lineNumber:37,columnNumber:9},void 0)},z=/(https:\/\/www\.|http:\/\/www\.|https:\/\/|http:\/\/)?[a-zA-Z]{2,}(\.[a-zA-Z]{2,})(\.[a-zA-Z]{2,})?\/[a-zA-Z0-9]{2,}|((https:\/\/www\.|http:\/\/www\.|https:\/\/|http:\/\/)?[a-zA-Z]{2,}(\.[a-zA-Z]{2,})(\.[a-zA-Z]{2,})?)|(https:\/\/www\.|http:\/\/www\.|https:\/\/|http:\/\/)?[a-zA-Z0-9]{2,}\.[a-zA-Z0-9]{2,}\.[a-zA-Z0-9]{2,}(\.[a-zA-Z0-9]{2,})?/g,y=e=>{const{children:t,initialParams:r,className:s,error:i,darkMode:a,onEnter:u,abortController:l}=e,[o,m]=c.useState(r?.roomId!==void 0),f=c.useCallback(()=>m(d=>!d),[m]),b=j.useForm({defaultValues:r,mode:"onSubmit",reValidateMode:"onSubmit",shouldUseNativeValidation:!0,delayError:500,shouldFocusError:!1}),N=A(async d=>{console.log("$$$","ON SUBMIT"),await u?.({joinMode:d.roomId!==void 0,serverUrl:d.serverUrl,roomId:d.roomId,playerName:d.playerName,settings:d.settings})});c.useEffect(()=>{r?.autoJoin&&(console.log("AUTO JOIN"),N(b.getValues()))},[r?.autoJoin]);const v=n.jsxDEV(n.Fragment,{children:[n.jsxDEV(D,{htmlType:"submit",disabled:l!=null,children:o?"Join room":"Create room"},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubEnterPage.tsx",lineNumber:69,columnNumber:13},void 0),n.jsxDEV(D,{type:"secondary",htmlType:"button",onClick:f,className:"vh-ml-2",disabled:l!=null,children:o?"Or create new room":"Or join existing room"},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubEnterPage.tsx",lineNumber:72,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubEnterPage.tsx",lineNumber:68,columnNumber:9},void 0);return n.jsxDEV("div",{className:h("varhub-page",s,{"dark-mode":a}),children:n.jsxDEV("form",{className:"varhub-form",onSubmit:b.handleSubmit(N),children:n.jsxDEV(U,{title:"SpyFall",actions:v,loading:l!=null,error:i,children:n.jsxDEV(j.FormProvider,{...b,children:[n.jsxDEV(V,{required:!0,className:"vh-mt-2",name:"serverUrl",label:"Varhub server URL",pattern:z,patternMessage:"Invalid url"},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubEnterPage.tsx",lineNumber:92,columnNumber:25},void 0),n.jsxDEV(V,{required:!0,className:"vh-mt-3",name:"playerName",label:"Player name"},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubEnterPage.tsx",lineNumber:100,columnNumber:25},void 0),o&&n.jsxDEV(w,{required:!0,min:0,className:"vh-mt-3",name:"roomId",label:"Room ID"},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubEnterPage.tsx",lineNumber:101,columnNumber:38},void 0),t&&!o&&n.jsxDEV(q,{children:t},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubEnterPage.tsx",lineNumber:103,columnNumber:29},void 0)]},void 0,!0,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubEnterPage.tsx",lineNumber:91,columnNumber:21},void 0)},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubEnterPage.tsx",lineNumber:90,columnNumber:17},void 0)},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubEnterPage.tsx",lineNumber:86,columnNumber:13},void 0)},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubEnterPage.tsx",lineNumber:85,columnNumber:9},void 0)},p=c.createContext(null),J=({children:e})=>{const[t,r]=c.useState(null),s=c.useMemo(()=>({client:t,setClient:r}),[t,r]);return n.jsxDEV(p.Provider,{value:s,children:e},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/context/VarhubGameClientContext.tsx",lineNumber:17,columnNumber:9},void 0)},Z=()=>c.useContext(p).client,F=e=>{const{roomIntegrity:t,importRoomModule:r,onEnter:s,children:i,darkMode:a,initialParams:u}=e,l=S(u),[o,m]=c.useState(null),f=c.useContext(p),[b,N]=c.useState(null),v=c.useCallback(async d=>{m(null);let g=null,P;try{console.log("$$$","CREATE CLIENT");const x=await E({...d,roomIntegrity:t,importRoomModule:r});g=x.client,P=x.roomId,s?.(g),f.setClient(g),k({...d,roomId:P,autoJoin:!0})}catch(x){const _=d.joinMode?"connect to":"create";m(`Error while trying to ${_} room`),console.error(x)}finally{N(null)}},[s]);return n.jsxDEV(y,{darkMode:a,initialParams:l,onEnter:v,abortController:b,error:o,children:i},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubSelfControlEnterPage.tsx",lineNumber:55,columnNumber:9},void 0)},O=e=>n.jsxDEV(V,{...e,name:"settings."+e.name},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/settings/SettingsInputParameter.tsx",lineNumber:8,columnNumber:9},void 0),T=e=>n.jsxDEV(w,{...e,name:"settings."+e.name},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/settings/SettingsNumberParameter.tsx",lineNumber:8,columnNumber:9},void 0),$=e=>{const{value:t,onChange:r,className:s,children:i}=e,a=c.useCallback(u=>{r?.(u.target.checked)},[r]);return n.jsxDEV("label",{className:h("vh-toggle",s),children:[n.jsxDEV("span",{className:"vh-toggle-label",children:i},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Switch/Switch.tsx",lineNumber:21,columnNumber:13},void 0),n.jsxDEV("input",{className:"vh-toggle-checkbox",checked:t,onChange:a,type:"checkbox"},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Switch/Switch.tsx",lineNumber:22,columnNumber:13},void 0),n.jsxDEV("div",{className:"vh-toggle-switch"},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Switch/Switch.tsx",lineNumber:23,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Switch/Switch.tsx",lineNumber:20,columnNumber:9},void 0)},L=e=>{const{name:t,label:r=e.name,className:s="vh-mt-3"}=e,{control:i,getValues:a}=j.useFormContext();return n.jsxDEV(j.Controller,{render:({field:u})=>n.jsxDEV($,{className:s,onChange:u.onChange,value:u.value,children:r},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/parameter/VarhubSwitchParameter.tsx",lineNumber:23,columnNumber:34},void 0),name:t,defaultValue:a(t)||!1,shouldUnregister:!0,control:i},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/parameter/VarhubSwitchParameter.tsx",lineNumber:22,columnNumber:9},void 0)},G=e=>n.jsxDEV(L,{...e,name:"settings."+e.name},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/settings/SettingsSwitchParameter.tsx",lineNumber:8,columnNumber:9},void 0);exports.SettingsInputParameter=O;exports.SettingsNumberParameter=T;exports.SettingsSwitchParameter=G;exports.VarhubEnterPage=y;exports.VarhubGameClientContext=p;exports.VarhubGameClientProvider=J;exports.VarhubSelfControlEnterPage=F;exports.createVarhubRoomAndClient=E;exports.getVarhubEnterParams=C;exports.saveVarhubEnterParams=k;exports.useVarhubGameClient=Z;exports.useVarhubInitialParams=S;
