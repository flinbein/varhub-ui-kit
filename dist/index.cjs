"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const A=require("@flinbein/varhub-web-client"),o=require("react"),n=require("react/jsx-dev-runtime"),f=require("classnames"),j=require("react-hook-form"),M=require("use-latest-callback");async function C(e){const{serverUrl:t,playerName:r,settings:s={},importRoomModule:i,roomIntegrity:a,engine:u="ivm",roomPublicMessage:m}=e;let c=e.roomId;const l=new A.Varhub(t);if(!c){const{integrity:h,module:N}=await i();c=(await l.createRoom(u,{module:N,integrity:h,config:s,message:m})).id}const b=l.join(c,{params:[r],integrity:a});return{roomId:c,client:b,playerName:r}}const k=e=>{const t=new URLSearchParams(location.search),r=JSON.parse(history?.state?.varhubEnterState||"{}"),s=t.get("serverUrl")??r.serverUrl??e.serverUrl??void 0,i=t.get("roomId")??r.roomId??void 0,a=r.playerName??void 0,u=r.settings??e.settings??{},m=r.autoJoin??!1;return{serverUrl:s,roomId:i,playerName:a,autoJoin:m,settings:u}},S=e=>{const t=new URL(location.href),r={varhubEnterState:JSON.stringify(e||{})};t.search="",history.replaceState(r,"",t)},w=e=>o.useRef(k(e)).current,U=({size:e})=>n.jsxDEV("span",{className:"vh-loader",style:{height:e,width:e}},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Loader/Loader.tsx",lineNumber:10,columnNumber:9},void 0),R=e=>{const{children:t,title:r,actions:s,loading:i,error:a}=e;return n.jsxDEV("div",{className:f("varhub-card"),children:[n.jsxDEV("div",{className:"varhub-card__content varhub-card__header",children:[n.jsxDEV("h2",{className:"varhub-card__header__text",children:r},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Card/Card.tsx",lineNumber:20,columnNumber:17},void 0),i&&n.jsxDEV(U,{size:24},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Card/Card.tsx",lineNumber:21,columnNumber:29},void 0)]},void 0,!0,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Card/Card.tsx",lineNumber:19,columnNumber:13},void 0),n.jsxDEV("div",{className:"varhub-card__content varhub-card__body",children:t},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Card/Card.tsx",lineNumber:23,columnNumber:13},void 0),s&&n.jsxDEV("div",{className:"varhub-card__content varhub-card__actions varhub-card__divider--top",children:s},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Card/Card.tsx",lineNumber:28,columnNumber:17},void 0),a&&n.jsxDEV("div",{className:"varhub-card__error varhub-card__content varhub-card__divider--top",children:a},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Card/Card.tsx",lineNumber:34,columnNumber:17},void 0),n.jsxDEV("div",{className:"varhub-card__powered-by varhub-card__content varhub-card__divider--top",children:["Powered by ",n.jsxDEV("a",{className:"varhub-card__link",href:"https://github.com/flinbein/varhub-web-server",children:"VarHub"},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Card/Card.tsx",lineNumber:40,columnNumber:28},void 0)]},void 0,!0,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Card/Card.tsx",lineNumber:39,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Card/Card.tsx",lineNumber:18,columnNumber:9},void 0)},P=e=>{const{name:t,placeholder:r,label:s=e.name,className:i="vh-mt-3",required:a=!1,pattern:u,patternMessage:m}=e,{register:c}=j.useFormContext(),l=o.useMemo(()=>{if(u)return{value:u,message:m||"Invalid pattern"}},[u,m]);return n.jsxDEV("div",{className:f("varhub-parameter-input",i),children:[n.jsxDEV("input",{placeholder:r,type:"text",required:a,...c(t,{shouldUnregister:!0,required:a,pattern:l})},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/parameter/VarhubInputParameter.tsx",lineNumber:36,columnNumber:13},void 0),n.jsxDEV("label",{children:s},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/parameter/VarhubInputParameter.tsx",lineNumber:37,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/parameter/VarhubInputParameter.tsx",lineNumber:35,columnNumber:9},void 0)},q=({direction:e})=>n.jsxDEV("i",{className:f("vh-arrow",e)},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/icon/ArrowIcon.tsx",lineNumber:13,columnNumber:9},void 0),z=({children:e})=>{const[t,r]=o.useState(!1),s=o.useCallback(()=>{r(i=>!i)},[r]);return n.jsxDEV("div",{className:"vh-settings-section varhub-card__divider--top",children:[n.jsxDEV("h5",{className:"vh-settings-section__title",children:["Settings",n.jsxDEV("a",{className:f("vh-settings-section__title__button",{reversed:t}),onClick:s,type:"button",children:n.jsxDEV(q,{direction:"down"},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/settings/SettingsSection.tsx",lineNumber:24,columnNumber:21},void 0)},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/settings/SettingsSection.tsx",lineNumber:19,columnNumber:17},void 0)]},void 0,!0,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/settings/SettingsSection.tsx",lineNumber:17,columnNumber:13},void 0),n.jsxDEV("div",{className:`vh-settings-section__body ${t?"shown":"hidden"}`,children:e},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/settings/SettingsSection.tsx",lineNumber:27,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/settings/SettingsSection.tsx",lineNumber:16,columnNumber:9},void 0)},E=e=>{const{children:t,htmlType:r,type:s="primary",className:i,onClick:a,disabled:u,...m}=e,c=l=>{u||a?.(l)};return n.jsxDEV("button",{type:r,...m,onClick:c,disabled:u,className:f("varhub-button",i,{[`type-${s}`]:s}),children:t},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Button/VarhubButton.tsx",lineNumber:34,columnNumber:9},void 0)},_=e=>{const{name:t,placeholder:r,label:s=e.name,className:i="vh-mt-3",min:a,max:u,required:m=!1}=e,{register:c}=j.useFormContext(),l=o.useCallback(b=>{const h=parseInt(b);if(!isNaN(h))return h},[]);return n.jsxDEV("div",{className:f("varhub-parameter-input",i),children:[n.jsxDEV("input",{placeholder:r,type:"number",min:a,max:u,...c(t,{min:a,max:u,shouldUnregister:!0,required:m,setValueAs:l})},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/parameter/VarhubNumberParameter.tsx",lineNumber:38,columnNumber:13},void 0),n.jsxDEV("label",{children:s},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/parameter/VarhubNumberParameter.tsx",lineNumber:45,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/parameter/VarhubNumberParameter.tsx",lineNumber:37,columnNumber:9},void 0)},Z=/(https:\/\/www\.|http:\/\/www\.|https:\/\/|http:\/\/)?[a-zA-Z]{2,}(\.[a-zA-Z]{2,})(\.[a-zA-Z]{2,})?\/[a-zA-Z0-9]{2,}|((https:\/\/www\.|http:\/\/www\.|https:\/\/|http:\/\/)?[a-zA-Z]{2,}(\.[a-zA-Z]{2,})(\.[a-zA-Z]{2,})?)|(https:\/\/www\.|http:\/\/www\.|https:\/\/|http:\/\/)?[a-zA-Z0-9]{2,}\.[a-zA-Z0-9]{2,}\.[a-zA-Z0-9]{2,}(\.[a-zA-Z0-9]{2,})?/g,y=e=>{const{children:t,title:r,initialParams:s,className:i,error:a,darkMode:u,onEnter:m,abortController:c}=e,[l,b]=o.useState(s?.roomId!==void 0),h=o.useCallback(()=>b(d=>!d),[b]),N=j.useForm({defaultValues:s,mode:"onSubmit",reValidateMode:"onSubmit",shouldUseNativeValidation:!0,delayError:500,shouldFocusError:!1}),v=M(async d=>{await m?.({joinMode:d.roomId!==void 0,serverUrl:d.serverUrl,roomId:d.roomId,playerName:d.playerName,settings:d.settings})});o.useEffect(()=>{s?.autoJoin&&v(N.getValues())},[s?.autoJoin]);const g=n.jsxDEV(n.Fragment,{children:[n.jsxDEV(E,{htmlType:"submit",disabled:c!=null,children:l?"Join room":"Create room"},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubEnterPage.tsx",lineNumber:67,columnNumber:13},void 0),n.jsxDEV(E,{type:"secondary",htmlType:"button",onClick:h,className:"vh-ml-2",disabled:c!=null,children:l?"Or create new room":"Or join existing room"},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubEnterPage.tsx",lineNumber:70,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubEnterPage.tsx",lineNumber:66,columnNumber:9},void 0);return n.jsxDEV("div",{className:f("varhub-page",i,{"dark-mode":u}),children:n.jsxDEV("form",{className:"varhub-form",onSubmit:N.handleSubmit(v),children:n.jsxDEV(R,{title:r,actions:g,loading:c!=null,error:a,children:n.jsxDEV(j.FormProvider,{...N,children:[n.jsxDEV(P,{required:!0,className:"vh-mt-2",name:"serverUrl",label:"Varhub server URL",pattern:Z,patternMessage:"Invalid url"},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubEnterPage.tsx",lineNumber:90,columnNumber:25},void 0),n.jsxDEV(P,{required:!0,className:"vh-mt-3",name:"playerName",label:"Player name"},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubEnterPage.tsx",lineNumber:98,columnNumber:25},void 0),l&&n.jsxDEV(_,{required:!0,min:0,className:"vh-mt-3",name:"roomId",label:"Room ID"},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubEnterPage.tsx",lineNumber:99,columnNumber:38},void 0),t&&!l&&n.jsxDEV(z,{children:t},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubEnterPage.tsx",lineNumber:101,columnNumber:29},void 0)]},void 0,!0,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubEnterPage.tsx",lineNumber:89,columnNumber:21},void 0)},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubEnterPage.tsx",lineNumber:88,columnNumber:17},void 0)},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubEnterPage.tsx",lineNumber:84,columnNumber:13},void 0)},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubEnterPage.tsx",lineNumber:83,columnNumber:9},void 0)},p=o.createContext(null),J=({children:e})=>{const[t,r]=o.useState(null),s=o.useMemo(()=>({client:t,setClient:r}),[t,r]);return n.jsxDEV(p.Provider,{value:s,children:e},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/context/VarhubGameClientContext.tsx",lineNumber:17,columnNumber:9},void 0)},F=()=>o.useContext(p).client,L=e=>{const{roomIntegrity:t,importRoomModule:r,onEnter:s,title:i,children:a,darkMode:u,initialParams:m}=e,c=w(m),[l,b]=o.useState(null),h=o.useContext(p),[N,v]=o.useState(null),g=o.useCallback(async d=>{b(null);let V=null,D;try{console.log("$$$","CREATE CLIENT");const x=await C({...d,roomIntegrity:t,importRoomModule:r});V=await x.client,D=x.roomId,s?.(V),h.setClient(V),S({...d,roomId:D,autoJoin:!0})}catch(x){const I=d.joinMode?"connect to":"create";b(`Error while trying to ${I} room`),console.error(x)}finally{v(null)}},[s]);return n.jsxDEV(y,{darkMode:u,initialParams:c,onEnter:g,title:i,abortController:N,error:l,children:a},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/VarhubSelfControlEnterPage.tsx",lineNumber:64,columnNumber:9},void 0)},G=e=>n.jsxDEV(P,{...e,name:"settings."+e.name},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/settings/SettingsInputParameter.tsx",lineNumber:8,columnNumber:9},void 0),T=e=>n.jsxDEV(_,{...e,name:"settings."+e.name},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/settings/SettingsNumberParameter.tsx",lineNumber:8,columnNumber:9},void 0),O=e=>{const{value:t,onChange:r,className:s,children:i}=e,a=o.useCallback(u=>{r?.(u.target.checked)},[r]);return n.jsxDEV("label",{className:f("vh-toggle",s),children:[n.jsxDEV("span",{className:"vh-toggle-label",children:i},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Switch/Switch.tsx",lineNumber:21,columnNumber:13},void 0),n.jsxDEV("input",{className:"vh-toggle-checkbox",checked:t,onChange:a,type:"checkbox"},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Switch/Switch.tsx",lineNumber:22,columnNumber:13},void 0),n.jsxDEV("div",{className:"vh-toggle-switch"},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Switch/Switch.tsx",lineNumber:23,columnNumber:13},void 0)]},void 0,!0,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/Switch/Switch.tsx",lineNumber:20,columnNumber:9},void 0)},$=e=>{const{name:t,label:r=e.name,className:s="vh-mt-3"}=e,{control:i,getValues:a}=j.useFormContext();return n.jsxDEV(j.Controller,{render:({field:u})=>n.jsxDEV(O,{className:s,onChange:u.onChange,value:u.value,children:r},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/parameter/VarhubSwitchParameter.tsx",lineNumber:23,columnNumber:34},void 0),name:t,defaultValue:a(t)||!1,shouldUnregister:!0,control:i},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/parameter/VarhubSwitchParameter.tsx",lineNumber:22,columnNumber:9},void 0)},B=e=>n.jsxDEV($,{...e,name:"settings."+e.name},void 0,!1,{fileName:"D:/Projects/js/varhub-ui-kit/src/components/settings/SettingsSwitchParameter.tsx",lineNumber:8,columnNumber:9},void 0);exports.SettingsInputParameter=G;exports.SettingsNumberParameter=T;exports.SettingsSwitchParameter=B;exports.VarhubEnterPage=y;exports.VarhubGameClientContext=p;exports.VarhubGameClientProvider=J;exports.VarhubSelfControlEnterPage=L;exports.createVarhubRoomAndClient=C;exports.getVarhubEnterParams=k;exports.saveVarhubEnterParams=S;exports.useVarhubGameClient=F;exports.useVarhubInitialParams=w;
